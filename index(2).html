<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³ã«è¼‰ã›ãªã„è¨­å®š -->
    <meta name="robots" content="noindex">
    <title>ä»•è¨³deã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³ - å…¨å•†2ç´šç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=DotGothic16&family=Noto+Sans+JP:wght@400;700&display=swap');
        
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: #f0f2f5;
            touch-action: manipulation;
        }

        .pixel-font { font-family: 'DotGothic16', sans-serif; }

        /* æ—¢å­˜ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ç¶­æŒ */
        .card-animate { transition: all 0.2s ease-out; user-select: none; touch-action: none; }
        .drop-zone { min-height: 120px; border: 2px dashed #cbd5e1; border-radius: 12px; background-color: rgba(255,255,255,0.5); }
        .drop-zone.drag-over { background-color: rgba(59, 130, 246, 0.1); border-color: #3b82f6; }
        .catalog-scroll, .inventory-scroll { overflow-y: auto; -webkit-overflow-scrolling: touch; }
        .catalog-scroll { max-height: 50vh; }
        .inventory-scroll { max-height: 30vh; }
        .dragging { opacity: 0.5; transform: scale(1.1); z-index: 1000; }
        #qr-modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 2000; justify-content: center; align-items: center; padding: 20px; }
    </style>
</head>
<body class="p-2 md:p-8">

    <div id="app" class="max-w-6xl mx-auto">
        <!-- Header -->
        <header class="flex justify-between items-center mb-4 bg-white p-4 md:p-6 rounded-2xl shadow-sm border-b-4 border-red-500">
            <div>
                <h1 class="text-xl md:text-3xl font-bold text-red-800 pixel-font">ä»•è¨³deã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³</h1>
                <p class="text-[10px] md:text-sm text-gray-500 font-bold">å…¨å•†2ç´š å¯¾ç­–ã‚¢ãƒ—ãƒª</p>
            </div>
            <div class="flex items-center gap-4">
                <button onclick="showQRCode()" class="bg-gray-100 p-2 rounded-lg hover:bg-gray-200 transition-colors" title="ã“ã®ã‚¢ãƒ—ãƒªã®QRã‚’è¡¨ç¤º">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="5" height="5" x="3" y="3" rx="1"/><rect width="5" height="5" x="16" y="3" rx="1"/><rect width="5" height="5" x="3" y="16" rx="1"/><path d="M21 16h-3a2 2 0 0 0-2 2v3"/><path d="M21 21v.01"/><path d="M12 7v3a2 2 0 0 1-2 2H7"/><path d="M3 12h.01"/><path d="M12 3h.01"/><path d="M12 16v.01"/><path d="M16 12h1"/><path d="M21 12v.01"/><path d="M12 21v.01"/></svg>
                </button>
                <div class="text-right">
                    <div class="text-[10px] text-gray-400">äºˆç®—æ®‹é«˜</div>
                    <div class="text-lg md:text-2xl font-bold text-orange-600" id="current-balance">Â¥3,000,000</div>
                </div>
            </div>
        </header>

        <!-- QR Modal -->
        <div id="qr-modal" onclick="closeQRCode()">
            <div class="bg-white p-8 rounded-2xl text-center space-y-4" onclick="event.stopPropagation()">
                <h3 class="font-bold text-lg">å…±æœ‰ç”¨QRã‚³ãƒ¼ãƒ‰</h3>
                <div id="qrcode-container" class="flex justify-center p-4 bg-white"></div>
                <button onclick="closeQRCode()" class="w-full py-2 bg-gray-800 text-white rounded-xl font-bold">é–‰ã˜ã‚‹</button>
            </div>
        </div>

        <!-- Main Game Area -->
        <div id="game-container">
            <!-- Phase 1: Purchase (Catalog) -->
            <div id="auction-phase" class="space-y-4">
                <div class="bg-gray-50 p-4 rounded-2xl border-2 border-gray-300">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-lg font-bold text-gray-700 italic">ğŸ›ï¸ ç§‘ç›®ã‚«ã‚¿ãƒ­ã‚°ï¼ˆä¸€å¾‹ Â¥200,000ï¼‰</h2>
                        <button id="start-settlement" onclick="startSettlement()" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded-xl shadow-lg transition-all active:scale-95">
                            ä»•è¨³æ§‹ç¯‰ã¸é€²ã‚€ â”
                        </button>
                    </div>
                    <div id="item-catalog" class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 gap-2 catalog-scroll p-1"></div>
                </div>
                <div class="bg-white p-4 rounded-2xl shadow-sm border-t-4 border-orange-400">
                    <h3 class="text-sm font-bold text-gray-700 mb-2">ğŸ›’ è³¼å…¥æ¸ˆã¿ã®ç§‘ç›® (<span id="inv-count">0</span>)</h3>
                    <div id="inventory" class="flex flex-wrap gap-2 md:gap-4 min-h-[60px] inventory-scroll p-1"></div>
                </div>
            </div>

            <!-- Phase 2: Settlement -->
            <div id="settlement-phase" class="hidden space-y-4">
                <div class="text-center mb-2">
                    <h2 class="text-lg md:text-2xl font-bold text-green-700">âœï¸ æ±ºç®—æ•´ç†ä»•è¨³</h2>
                </div>
                <div class="grid grid-cols-2 gap-2 md:gap-8">
                    <div class="bg-red-50 p-3 rounded-xl border-t-4 border-red-400">
                        <div class="flex justify-between items-center mb-2">
                            <h3 class="text-xs md:text-sm font-bold text-red-700">å€Ÿæ–¹ (Dr.)</h3>
                            <span id="debit-total" class="text-[10px] md:text-sm font-bold text-red-600">Â¥0</span>
                        </div>
                        <div id="debit-zone" class="drop-zone p-2 flex flex-wrap gap-1" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                    </div>
                    <div class="bg-blue-50 p-3 rounded-xl border-t-4 border-blue-400">
                        <div class="flex justify-between items-center mb-2">
                            <h3 class="text-xs md:text-sm font-bold text-blue-700">è²¸æ–¹ (Cr.)</h3>
                            <span id="credit-total" class="text-[10px] md:text-sm font-bold text-blue-600">Â¥0</span>
                        </div>
                        <div id="credit-zone" class="drop-zone p-2 flex flex-wrap gap-1" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                    </div>
                </div>
                <div class="bg-gray-100 p-4 rounded-2xl">
                    <h3 class="text-xs md:text-sm font-bold mb-2">æ‰‹å…ƒã®ã‚«ãƒ¼ãƒ‰</h3>
                    <div id="pool-zone" class="flex flex-wrap gap-2 min-h-[100px]" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                </div>
                <div class="flex justify-center pb-8">
                    <button onclick="calculateResult()" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-4 px-8 rounded-xl text-lg shadow-xl active:scale-95">æ±ºç®—ç¢ºå®š</button>
                </div>
            </div>

            <!-- Phase 3: Result -->
            <div id="result-phase" class="hidden text-center space-y-6 bg-white p-6 md:p-12 rounded-3xl shadow-2xl border-4 md:border-8 border-double border-blue-200">
                <div class="pixel-font text-3xl md:text-5xl text-blue-600 mb-2" id="result-status">COMPLETED</div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-2">
                    <div class="p-3 bg-blue-50 rounded-xl"><div class="text-xs text-gray-500">ç·åç›Š</div><div class="text-lg md:text-2xl font-bold text-blue-600" id="res-revenue">Â¥0</div></div>
                    <div class="p-3 bg-red-50 rounded-xl"><div class="text-xs text-gray-500">ç·è²»ç”¨</div><div class="text-lg md:text-2xl font-bold text-red-600" id="res-expense">Â¥0</div></div>
                    <div class="p-3 bg-orange-100 rounded-xl border-2 border-orange-300"><div class="text-xs text-gray-600 font-bold">å½“æœŸç´”åˆ©ç›Š</div><div class="text-lg md:text-2xl font-black text-orange-600" id="final-profit">Â¥0</div></div>
                </div>
                <div id="result-details" class="max-w-md mx-auto bg-gray-50 p-4 rounded-xl text-left text-sm space-y-2 border border-gray-200"></div>
                <div class="pt-4"><button onclick="location.reload()" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-full shadow-lg">ã‚‚ã†ä¸€åº¦</button></div>
            </div>
        </div>
    </div>

    <script>
        const ITEMS = [
            { id: 1, name: "ç¾é‡‘", type: "è³‡ç”£", icon: "ğŸ’°", value: 500000 },
            { id: 2, name: "å½“åº§é é‡‘", type: "è³‡ç”£", icon: "ğŸ¦", value: 800000 },
            { id: 3, name: "å—å–æ‰‹å½¢", type: "è³‡ç”£", icon: "å½¹", value: 600000 },
            { id: 4, name: "å£²æ›é‡‘", type: "è³‡ç”£", icon: "ğŸ“„", value: 900000 },
            { id: 5, name: "å£²è²·ç›®çš„æœ‰ä¾¡è¨¼åˆ¸", type: "è³‡ç”£", icon: "ğŸ“ˆ", value: 400000 },
            { id: 6, name: "è²¸ä»˜é‡‘", type: "è³‡ç”£", icon: "ğŸ¤", value: 700000 },
            { id: 7, name: "å»ºç‰©", type: "è³‡ç”£", icon: "ğŸ¢", value: 2500000 },
            { id: 8, name: "è»Šä¸¡é‹æ¬å…·", type: "è³‡ç”£", icon: "ğŸšš", value: 1200000 },
            { id: 9, name: "ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢", type: "è³‡ç”£", icon: "ğŸ’»", value: 300000 },
            { id: 10, name: "æœªååç›Š", type: "è³‡ç”£", icon: "â³", value: 100000 },
            { id: 11, name: "å‰æ‰•è²»ç”¨", type: "è³‡ç”£", icon: "ğŸ“…", value: 150000 },
            { id: 12, name: "æ”¯æ‰•æ‰‹å½¢", type: "è² å‚µ", icon: "âœï¸", value: 500000 },
            { id: 13, name: "è²·æ›é‡‘", type: "è² å‚µ", icon: "ğŸ›’", value: 800000 },
            { id: 14, name: "é•·æœŸå€Ÿå…¥é‡‘", type: "è² å‚µ", icon: "ğŸ’¸", value: 1500000 },
            { id: 15, name: "é€€è·çµ¦ä»˜å¼•å½“é‡‘", type: "è² å‚µ", icon: "ğŸ‘´", value: 600000 },
            { id: 16, name: "æœªæ‰•è²»ç”¨", type: "è² å‚µ", icon: "ğŸ“‹", value: 120000 },
            { id: 17, name: "å‰å—åç›Š", type: "è² å‚µ", icon: "ğŸ“¥", value: 90000 },
            { id: 18, name: "æ³•äººç¨ç­‰èª¿æ•´é¡", type: "è² å‚µ", icon: "ğŸ›ï¸", value: 200000 },
            { id: 19, name: "å£²ä¸Š", type: "åç›Š", icon: "ğŸ”¥", value: 3000000 },
            { id: 20, name: "å—å–åˆ©æ¯", type: "åç›Š", icon: "ğŸª™", value: 50000 },
            { id: 21, name: "æœ‰ä¾¡è¨¼åˆ¸è©•ä¾¡ç›Š", type: "åç›Š", icon: "ğŸ’", value: 150000 },
            { id: 22, name: "å›½åº«è£œåŠ©é‡‘å—è´ˆç›Š", type: "åç›Š", icon: "ğŸ‡¯ğŸ‡µ", value: 500000 },
            { id: 23, name: "å›ºå®šè³‡ç”£å£²å´ç›Š", type: "åç›Š", icon: "ğŸ ", value: 300000 },
            { id: 24, name: "å—å–é…å½“é‡‘", type: "åç›Š", icon: "ğŸ‡", value: 80000 },
            { id: 25, name: "ä»•å…¥", type: "è²»ç”¨", icon: "ğŸ“¦", value: 1800000 },
            { id: 26, name: "çµ¦æ–™", type: "è²»ç”¨", icon: "ğŸ‘”", value: 800000 },
            { id: 27, name: "æ¸›ä¾¡å„Ÿå´è²»", type: "è²»ç”¨", icon: "ğŸ“‰", value: 400000 },
            { id: 28, name: "è²¸å€’å¼•å½“é‡‘ç¹°å…¥", type: "è²»ç”¨", icon: "âš ï¸", value: 70000 },
            { id: 29, name: "æ”¯æ‰•åˆ©æ¯", type: "è²»ç”¨", icon: "âš–ï¸", value: 60000 },
            { id: 30, name: "ç§Ÿç¨å…¬èª²", type: "è²»ç”¨", icon: "ğŸ“œ", value: 100000 }
        ];

        let balance = 3000000; 
        let inventory = [];
        const PURCHASE_PRICE = 200000;
        let draggedEl = null;
        let activeZones = [];

        function initGame() {
            initCatalog();
            updateDisplay();
            activeZones = [document.getElementById('debit-zone'), document.getElementById('credit-zone'), document.getElementById('pool-zone')];
            new QRCode(document.getElementById("qrcode-container"), {
                text: window.location.href,
                width: 180,
                height: 180
            });
        }

        function initCatalog() {
            const catalog = document.getElementById('item-catalog');
            catalog.innerHTML = '';
            ITEMS.forEach(item => {
                const btn = document.createElement('button');
                btn.className = "p-2 rounded-lg border bg-white shadow-sm flex flex-col items-center hover:border-orange-400 hover:shadow-md transition-all active:scale-95";
                btn.onclick = () => buyItem(item, btn);
                const typeColors = { "è³‡ç”£": "text-green-600", "è² å‚µ": "text-red-600", "åç›Š": "text-blue-600", "è²»ç”¨": "text-yellow-600" };
                btn.innerHTML = `<div class="text-xl mb-1">${item.icon}</div><div class="text-[9px] font-bold h-6 overflow-hidden">${item.name}</div><div class="text-[8px] ${typeColors[item.type]} font-bold">${item.type}</div>`;
                catalog.appendChild(btn);
            });
        }

        function buyItem(item, btnElement) {
            if (balance < PURCHASE_PRICE) return;
            balance -= PURCHASE_PRICE;
            inventory.push({...item});
            document.getElementById('inventory').appendChild(createCardElement(item));
            btnElement.classList.add('opacity-30', 'grayscale');
            btnElement.disabled = true;
            updateDisplay();
        }

        function createCardElement(item, isDraggable = false) {
            const div = document.createElement('div');
            div.className = `p-2 rounded-lg border bg-white shadow-sm flex flex-col items-center w-20 md:w-24 card-animate cursor-move shrink-0`;
            div.id = `card-${Math.random().toString(36).substr(2, 9)}`;
            div.innerHTML = `<div class="text-xl md:text-2xl">${item.icon}</div><div class="text-[8px] md:text-[10px] font-bold truncate w-full text-center">${item.name}</div><div class="text-[8px] text-gray-400">Â¥${item.value.toLocaleString()}</div>`;
            div.dataset.itemData = JSON.stringify(item);
            if (isDraggable) {
                div.draggable = true;
                div.ondragstart = (e) => { e.dataTransfer.setData("text/plain", e.target.id); e.target.classList.add('dragging'); };
                div.ondragend = (e) => e.target.classList.remove('dragging');
                div.addEventListener('touchstart', handleTouchStart, { passive: false });
                div.addEventListener('touchmove', handleTouchMove, { passive: false });
                div.addEventListener('touchend', handleTouchEnd, { passive: false });
            }
            return div;
        }

        function handleTouchStart(e) { draggedEl = e.currentTarget; draggedEl.classList.add('dragging'); }
        function handleTouchMove(e) {
            if (!draggedEl) return;
            e.preventDefault();
            const touch = e.touches[0];
            draggedEl.style.position = 'fixed';
            draggedEl.style.left = (touch.pageX - 40) + 'px';
            draggedEl.style.top = (touch.pageY - 40) + 'px';
            activeZones.forEach(zone => {
                const rect = zone.getBoundingClientRect();
                if (touch.clientX >= rect.left && touch.clientX <= rect.right && touch.clientY >= rect.top && touch.clientY <= rect.bottom) {
                    zone.classList.add('drag-over');
                } else { zone.classList.remove('drag-over'); }
            });
        }
        function handleTouchEnd(e) {
            if (!draggedEl) return;
            draggedEl.classList.remove('dragging');
            const touch = e.changedTouches[0];
            activeZones.forEach(zone => {
                zone.classList.remove('drag-over');
                const rect = zone.getBoundingClientRect();
                if (touch.clientX >= rect.left && touch.clientX <= rect.right && touch.clientY >= rect.top && touch.clientY <= rect.bottom) {
                    zone.appendChild(draggedEl);
                }
            });
            draggedEl.style.position = ''; draggedEl.style.left = ''; draggedEl.style.top = ''; draggedEl = null;
            updateZoneTotals();
        }

        function startSettlement() {
            if (inventory.length === 0) return;
            document.getElementById('auction-phase').classList.add('hidden');
            document.getElementById('settlement-phase').classList.remove('hidden');
            const pool = document.getElementById('pool-zone');
            pool.innerHTML = '';
            inventory.forEach(item => pool.appendChild(createCardElement(item, true)));
        }

        function allowDrop(e) { e.preventDefault(); e.currentTarget.classList.add('drag-over'); }
        function drop(e) {
            e.preventDefault(); e.currentTarget.classList.remove('drag-over');
            const id = e.dataTransfer.getData("text/plain");
            const el = document.getElementById(id);
            if (el) e.currentTarget.appendChild(el);
            updateZoneTotals();
        }

        function updateZoneTotals() {
            const sum = (id) => Array.from(document.getElementById(id).children).reduce((a, b) => a + JSON.parse(b.dataset.itemData).value, 0);
            document.getElementById('debit-total').innerText = `Â¥${sum('debit-zone').toLocaleString()}`;
            document.getElementById('credit-total').innerText = `Â¥${sum('credit-zone').toLocaleString()}`;
        }

        function calculateResult() {
            const debitItems = Array.from(document.getElementById('debit-zone').children).map(el => JSON.parse(el.dataset.itemData));
            const creditItems = Array.from(document.getElementById('credit-zone').children).map(el => JSON.parse(el.dataset.itemData));
            let dSum = debitItems.reduce((a, b) => a + b.value, 0);
            let cSum = creditItems.reduce((a, b) => a + b.value, 0);
            let rev = inventory.filter(i => i.type === "åç›Š").reduce((a, b) => a + b.value, 0);
            let exp = inventory.filter(i => i.type === "è²»ç”¨").reduce((a, b) => a + b.value, 0);
            const isBalanced = (dSum === cSum && dSum > 0);
            document.getElementById('settlement-phase').classList.add('hidden');
            document.getElementById('result-phase').classList.remove('hidden');
            document.getElementById('res-revenue').innerText = `Â¥${rev.toLocaleString()}`;
            document.getElementById('res-expense').innerText = `Â¥${exp.toLocaleString()}`;
            document.getElementById('final-profit').innerText = `Â¥${(rev - exp).toLocaleString()}`;
            document.getElementById('result-details').innerHTML = `<div class="flex justify-between"><span>å€Ÿæ–¹åˆè¨ˆ:</span> <span>Â¥${dSum.toLocaleString()}</span></div><div class="flex justify-between"><span>è²¸æ–¹åˆè¨ˆ:</span> <span>Â¥${cSum.toLocaleString()}</span></div><div class="mt-4 font-bold text-center ${isBalanced ? 'text-green-600' : 'text-red-600'}">${isBalanced ? 'ä¸€è‡´ã—ã¾ã—ãŸï¼' : 'ä¸ä¸€è‡´ã§ã™ã€‚'}</div>`;
            document.getElementById('result-status').innerText = isBalanced ? "EXCELLENT" : "FAILED";
        }

        function updateDisplay() {
            document.getElementById('current-balance').innerText = `Â¥${balance.toLocaleString()}`;
            document.getElementById('inv-count').innerText = inventory.length;
        }

        function showQRCode() { document.getElementById('qr-modal').style.display = 'flex'; }
        function closeQRCode() { document.getElementById('qr-modal').style.display = 'none'; }

        // åˆæœŸå®Ÿè¡Œ
        window.onload = initGame;
    </script>
</body>
</html>